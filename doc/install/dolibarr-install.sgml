<!doctype linuxdoc system>

<article>

<!-- Title information -->

<title>Dolibarr Installation</title>
<author>
 <name>Rodolphe Quiédeville</name>
</author>
<date>$Id$</date>
<abstract>
Installation et mise à jour de Dolibarr
</abstract>

<!-- Table of contents -->
<toc>

<!-- Begin the document -->
  
<sect>
<heading>Installation</heading>

<sect1>
<heading>Récupérer les sources</heading>
<p>
 Récupérer les sources sur <url url="http://www.dolibarr.com/">
</p>
  
    <p>
      Les sources se présentent sous la forme d'un fichier tar compressé avec gzip.
</p>
</sect1> 

  
<sect1>
<heading>Pré-requis</heading>
    <p>
      Liste des logiciels à installer pour faire fonctionner Dolibarr :
      
      <itemize>
	<item>php4</item>
	<item>php4-mysql</item>
	<item>php4-curl (pour la partie gestion des adhérents)</item>
	<item>Apache</item>
      </itemize>
      Pour la gestion de l'authentification, Dolibarr fonctionne soit avec mod-auth-mysql soit avec Pear. Cette dernière est plus facile à installer.
      <itemize>
	<item>Pear (package Auth)</item>
	<item>libapache-mod-auth-mysql</item>
	</itemize>
      </p>
    
        <sect2>
	    <heading>Pear</heading>
	    <p>
	  Pear est un ensemble de classes et d'outils pour les installer et les mettre à jour. Les classes requises pour Dolibarr sont (par ordre d'installation) :

      <itemize>
	<item>Archive_Tar</item>
	<item>Console_Getopt</item>
	<item>PEAR</item>
	<item>Auth</item>
	<item>DB</item>
	</itemize>
</p>
<p>
Pour installer un paquet Pear, exécutez en root '$ pear install &lt;nom du paquet&gt;'.
</p>
	<p>
	  Pour plus d'informations sur Pear et sa configuration, veuillez vous reporter à son site officiel <url url="pear.php.net">.
	</p>
    </sect2>
</sect1>

<sect1>
<heading>Base de données</heading>
    <p>
      1- créer une base de données mysql appelée 'dolibarr' (vous
      pouvez changer le nom, dans ce cas remplacer dans la suite des
      commandes 'dolibarr' par le nom de votre base de données)
    </p>
    <p>
  <tscreen>
   <verb>
	# mysqladmin create dolibarr
   </verb>
  </tscreen>
    </p>
    <p>	
      2- charger la base en exécutant :
    </p>
    <p>
  <tscreen>
   <verb>
	# mysql dolibarr < mysql/mysql.sql
   </verb>
  </tscreen>
    </p>
</sect1>

<sect1>
<heading>Apache</heading>
    <p>
      Pour configurer Apache : des fichier httpd.conf.dist est fournit
      avec les sources, vous pouvez vous en servir pour configurer
      votre serveur, il est prévu pour que vous ayez juste à ajouter
      une régle Include dans votre fichier principal <file>httpd.conf</file>.
    </p>

<p>
Utilisez le fichier httpd.conf.dist pour l'authentification par Pear
(conseillé) et le fichier httpd.conf.dist.modauth pour utiliser
mod-auth-mysql.
</p>

</sect1>

<sect1>
<heading>Dolibarr</heading>
    <p>
      Créer un répertoire appelé <file>document</file> dans le répertoire <file>htdocs</file> des sources et affectez les droits d'écriture dans ce répertoire à l'utilisateur exécutant le serveur web.
    </p>

    <p>
      Créer un fichier <file>conf/conf.php</file> et donnez les droits d'écriture dans ce fichier à l'utilisateur exécutant le serveur web.
    </p>

<p>
 Pour configurer Dolibarr accédez à la page
 <tscreen><verb>/install.php</verb></tscreen>, pour vous logger utlisez
 le login <bf>admin</bf> avec le mot de passe <bf>admin</bf>.
</p>

<p>
  Si les contrôles sont corrects
  vous n'avez qu'à cliquer sur le lien, 'Configurer les modules'.
</p>

<p>
Une fois les modules configurés il ne reste plus qu'à définir les
utilisateurs et leurs permissions respectives. Pour cela cliquer sur
Accueil -> Utilisateurs
</p>

<p>
Il est fortement conseillé de supprimer le fichier install.php une fois l'installation terminée. De même pensez à modifier le mot de passe de l'utilisateur admin.
</p>
 </sect1>
</sect>



<sect>
<heading>Mise à jour</heading>

  <p>
    Certaines action sont nécessaires lors de la mise à jour de Dolibarr vers une version plus récente des sources.
  </p>

<sect1>
<heading>Mise à jour de la base de données</heading>
<p>
      Il peut être nécessaire de faire des modifications sur la structure et/ou les données contenues dans la base Mysql lors de la mise à jour de Dolibarr. Pour cela des scripts sont fournis dans le répertoire <file>mysql/migration/</file>. Il se présente sous la forme a.b.c-e.d.f.sql, les trois premiers numéros indique la version de départ et les 3 suivants la version que vous souhaitez atteindre. Si vous passez par exemple de la version 0.1.3 à la version 0.1.6 il vous faudra appliquer les patchs 0.1.3-0.1.4.sql, 0.1.4-0.1.5.sql et 0.1.5-0.1.6.sql si un patch n'éxiste pas d'une version à une autre c'est qu'il n'y a pas eu de modification de base.
</p>
</sect1>

<sect1>
<heading>Autres actions</heading>
<p>
Il peut-être nécessaire d'effectuer d'autres actions lors de la mise à
jour, comme la désactivation et la réactivation des modules. Cette
information est communiquée dans le fichier README à la racine des sources.
</p>
</sect1>
</sect>

<sect>
<heading>Annexe A - Fichiers de conf Apache</heading>



  <sect1>
<heading>Fichier de config pour Apache 1.3</heading>

    <p>
      Exemple pour l'authentification avec Pear
</p>
<p>
      <code>
	#
	# Sample httpd.conf for dolibarr
	#
	&lt;VirtualHost dolibarr.lafrere.lan&gt;
	ServerAdmin webmaster.fr@lolix.org
	DocumentRoot /home/www/dolibarr/dolibarr/htdocs
	ServerName dolibarr.lafrere.lan
	ErrorLog  /home/www/dolibarr/logs/error.log
	CustomLog /home/www/dolibarr/logs/access.log combined
	
	ErrorDocument 401 /public/error-401.html

        php_flag register_globals on		
	
	&lt;/VirtualHost&gt;	
      </code>
</p>
  </sect1>


  <sect1>
<heading>Fichier de config pour Apache 1.3 + mod_auth_mysql</heading>

    <p>
      Cet exemple ne fonctionne pas sur la série Apache 2, voir le fichier correspond dans la section suivante.
</p>
<p>
      <code>
	#
	# Sample httpd.conf for dolibarr
	#
	&lt;VirtualHost dolibarr.lafrere.lan&gt;
	ServerAdmin webmaster.fr@lolix.org
	DocumentRoot /home/www/dolibarr/dolibarr/htdocs
	ServerName dolibarr.lafrere.lan
	ErrorLog  /home/www/dolibarr/logs/error.log
	CustomLog /home/www/dolibarr/logs/access.log combined
	
	ErrorDocument 401 /public/error-401.html

        php_flag register_globals on
		
	&lt;Location /&gt;
	Options Indexes FollowSymLinks
	AllowOverride All
	Order deny,allow
	Deny from all

	AuthType 				Basic
	
	# N'utilisez la ligne suivante que si vous utilisez aussi
	# le module d'authentification basé sur postgresql
	#Auth_MySQL_Authoritative		on
	
	# Utilisez les lignes suivantes si le serveur Apache ne 
	# peut se logger en anonymous (ce qui est conseillé ;-)
	# rq. erics: sur ma debian je n'ai pas le droit de mettre ces
	# instructions dans un &lt;virtualhost&gt; ... (apache 1.3.27.0-2)
	#AuthMySQL_DefaultHost &lt;host&gt;
	#AuthMySQL_DefaultUser &lt;user&gt;
	#AuthMySQL_DefaultPassword &lt;pass&gt;
	
	Auth_MySQL_DB 			dolibarr
	Auth_MySQL_Password_Table 		llx_user
	Auth_MySQL_Username_Field 		login
	Auth_MySQL_Password_Field 		pass
	
	# Pour l'instant les pass sont enregistrés en clair
	# le stockage crypté est dans la TODO
	
	Auth_MySQL_Encrypted_Passwords 	off
	
	AuthName        			"Dolibarr"
	
	require valid-user
	satisfy any
	&lt;/Location&gt;
	
	&lt;Location /public/&gt;
	Options Indexes FollowSymLinks
	AllowOverride All
	Order deny,allow
	Allow from all
	&lt;/Location&gt;
	
	&lt;/VirtualHost&gt;	
      </code>
</p>
  </sect1>

  <sect1>
<heading>Fichier de config pour Apache 2 + mod_auth_mysql + webmin</heading>
    <p>


    <code>
      Options Indexes FollowSymLinks
      AllowOverride All
      Order deny,allow
      Deny from all
      
      AuthType Basic
      
      # N'utilisez la ligne suivante que si vous utilisez aussi
      # le module d'authentification basé sur postgresql
      AuthMySQLAuthoritative on

      # Utilisez les lignes suivantes si le serveur Apache ne 
      # peut se logger en anonymous (ce qui est conseillé ;-)
      # rq. erics: sur ma debian je n'ai pas le droit de mettre ces
      # instructions dans un &lt;virtualhost&gt; ... (apache 1.3.27.0-2)
      #AuthMySQL_DefaultHost &lt;host&gt;
      #AuthMySQL_DefaultUser &lt;user&gt;
      #AuthMySQL_DefaultPassword &lt;pass&gt;

      AuthMySQLHost localhost
      AuthMySQLUser leDBuser
      AuthMySQLPassword leDBpass
      AuthMySQLDB dolibarr
      AuthMySQLUserTable llx_user
      AuthMySQLNameField login
      AuthMySQLPasswordField pass
      
      # Pour l'instant les pass sont enregistrés en clair
      # le stockage crypté est dans la TODO
      AuthMySQLCryptedPasswords off
      
      AuthName "Dolibarr"
      
      require valid-user
      Satisfy any
    </code>
    </p>  

    <p>
      Pour les gens qui installent Dolibarr dans un répertoire,
      utilisez Webmin et ajoutez une "Per-Directory Options" à votre
      serveur virtuel. Utilisez "Location" comme "Type" et "/dolibarr"
      comme "Path". Une fois créée, editez les directives et copiez la
      config ci-dessus, sauvez, restartez Apache et testez en allant à
      domainname.com/dolibarr. Le navigateur va vous demander de taper
      le login/pass.
      
      Il faut créer des options pour chaque &lt;Location&gt; du fichier httpd.conf donné en exemple.
    </p>
    
    <p>
      Merci à la personne qui m'a transmis ces infos, et aux précédentes qui avaient fait de même au sujet d'Apache 2
    </p>

  </sect1>
  
</sect>

</article>
