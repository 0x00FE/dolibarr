<!doctype linuxdoc system>

<article>

<!-- Title information -->

<title>Dolibarr Installation</title>
<author>
 <name>Rodolphe QuiÈdeville</name>
</author>
<date>$Id$</date>
<abstract>
Installation et mise ‡ jour de Dolibarr
</abstract>

<!-- Table of contents -->
<toc>

<!-- Begin the document -->
  
<sect>
<heading>Installation</heading>

<sect1>
<heading>RÈcupÈrer les sources</heading>
<p>
 RÈcupÈrer les sources sur <url url="http://www.dolibarr.com/">
</p>
  
    <p>
      Les sources se prÈsentent sous la forme d'un fichier tar compressÈ avec gzip.
</p>
</sect1> 

  
<sect1>
<heading>PrÈ-requis</heading>
    <p>
      Liste des logiciels ‡ installer pour faire fonctionner Dolibarr :
      
      <itemize>
	<item>php4</item>
	<item>php4-mysql</item>
	<item>php4-curl (pour la partie gestion des adhÈrents)</item>
	<item>php4-gd (pour les graphiques)</item>
	<item>php4-cli (pour les scripts en mode console)</item>
	<item>Apache</item>
      </itemize>
      Pour la gestion de l'authentification, Dolibarr fonctionne soit avec mod-auth-mysql soit avec Pear. Cette derniËre est plus facile ‡ installer.
      <itemize>
	<item>libapache-mod-auth-mysql</item>
	</itemize>
      </p>
    
        <sect2>
    <heading>Pear</heading>
	    <p>
	  Pear n'est plus nÈcessaire ‡ partir de Dolibarr 2.0.0 les
	  librairies Pear utilisÈes ont ÈtÈ incluses dans les sources directement.
</p>

    </sect2>
</sect1>

<sect1>
<heading>Base de donnÈes</heading>
    <p>
      1- crÈer une base de donnÈes mysql appelÈe 'dolibarr' (vous
      pouvez changer le nom, dans ce cas remplacer dans la suite des
      commandes 'dolibarr' par le nom de votre base de donnÈes)
    </p>
    <p>
  <tscreen>
   <verb>
	# mysqladmin create dolibarr
   </verb>
  </tscreen>
    </p>
    <p>	
      2- charger la base en exÈcutant :
    </p>
    <p>
Cette Ètape n'est plus nÈcessaire ‡ partir de la version 2.0.0 de
Dolibarr le chargement de la base est effectuÈ lors de l'installation.
  <tscreen>
   <verb>
	# mysql dolibarr < mysql/mysql.sql
   </verb>
  </tscreen>
    </p>
</sect1>

<sect1>
<heading>Apache</heading>
    <p>
      Pour configurer Apache : des fichier httpd.conf.dist est fournit
      avec les sources, vous pouvez vous en servir pour configurer
      votre serveur, il est prÈvu pour que vous ayez juste ‡ ajouter
      une rÈgle Include dans votre fichier principal <file>httpd.conf</file>.
    </p>

<p>
Utilisez le fichier httpd.conf.dist pour l'authentification par Pear
(conseillÈ) et le fichier httpd.conf.dist.modauth pour utiliser
mod-auth-mysql.
</p>

</sect1>

<sect1>
<heading>Dolibarr</heading>
    <p>
      DÈcompressez l'archive
  <tscreen>
   <verb>
	# tar xvfz dolibarr-2.0.0-alpha1.tgz
   </verb>
  </tscreen>
    </p>


    <p>
      CrÈer un rÈpertoire appelÈ <file>documents</file> au mÍme niveau
      que le rÈpertoire <file>htdocs</file> et affectez les
      droits d'Ècriture dans ce rÈpertoire ‡ l'utilisateur exÈcutant
      le serveur web.

  <tscreen>
   <verb>
        # cd dolibarr-2.0.0-alpha1
	# mkdir documents
        # chown www-data.www-data documents
        # chmod 700 documents
   </verb>
  </tscreen>

    </p>

<p>
Ce rÈpertoire peut-Ítre diffÈrent, il vous suffira de l'indiquer lors
de la phase d'installation web.
</p>

    <p>
      CrÈer un fichier <file>conf/conf.php</file> et donnez les droits
      d'Ècriture dans ce fichier ‡ l'utilisateur exÈcutant le serveur
      web.

  <tscreen>
   <verb>
        # cd htdocs/conf/
	# touch conf.php
        # chown www-data.www-data conf.php
        # chmod 700 conf.php
   </verb>
  </tscreen>
    </p>

<p>
Pour des raisons de securite pensez a modifier les permissions sur ce
fichier, il n'est plus modifie une fois l'installation finie.
</p>

<p>
 Pour configurer Dolibarr accÈdez ‡ la page
 <tscreen><verb>/install/index.php</verb></tscreen>
</p>

<p>
  Suivez les ÅÈtapes une Å‡ une et l'installation devrait se faire sans douleurs.
</p>

<p>
  Si les contrÙles sont corrects vous n'avez qu'‡ cliquer sur le lien, 'Configurer les modules'.
</p>

<p>
Une fois les modules configurÈs il ne reste plus qu'‡ dÈfinir les
utilisateurs et leurs permissions respectives. Pour cela cliquer sur
Accueil -> Utilisateurs
</p>

<p>
Il est fortement conseillÈ de supprimer le rÅÈpertoire
<file>htdocs/install.php</file> une fois l'installation terminÈe. De
mÍme pensez ‡ modifier les permissions sur le fichier <file>conf/conf.php</file>.
</p>
 </sect1>
</sect>

<sect>
<heading>Mise ‡ jour</heading>

  <p>
    Certaines action sont nÈcessaires lors de la mise ‡ jour de Dolibarr vers une version plus rÈcente des sources.
  </p>

<sect1>
<heading>Mise ‡ jour de la base de donnÈes</heading>
<p>
      Il peut Ítre nÈcessaire de faire des modifications sur la structure et/ou les donnÈes contenues dans la base Mysql lors de la mise ‡ jour de Dolibarr. Pour cela des scripts sont fournis dans le rÈpertoire <file>mysql/migration/</file>. Il se prÈsente sous la forme a.b.c-e.d.f.sql, les trois premiers numÈros indique la version de dÈpart et les 3 suivants la version que vous souhaitez atteindre. Si vous passez par exemple de la version 0.1.3 ‡ la version 0.1.6 il vous faudra appliquer les patchs 0.1.3-0.1.4.sql, 0.1.4-0.1.5.sql et 0.1.5-0.1.6.sql si un patch n'Èxiste pas d'une version ‡ une autre c'est qu'il n'y a pas eu de modification de base.
</p>
</sect1>

<sect1>
<heading>Autres actions</heading>
<p>
Il peut-Ítre nÈcessaire d'effectuer d'autres actions lors de la mise ‡
jour, comme la dÈsactivation et la rÈactivation des modules. Cette
information est communiquÈe dans le fichier README ‡ la racine des sources.
</p>
</sect1>
</sect>

<sect>
<heading>Annexe A - Fichiers de conf Apache</heading>



  <sect1>
<heading>Fichier de config pour Apache 1.3</heading>

    <p>
      Exemple pour l'authentification avec Pear
</p>
<p>
      <code>
	#
	# Sample httpd.conf for dolibarr
	#
	&lt;VirtualHost dolibarr.lafrere.lan&gt;
	ServerAdmin webmaster.fr@lolix.org
	DocumentRoot /home/www/dolibarr/dolibarr/htdocs
	ServerName dolibarr.lafrere.lan
	ErrorLog  /home/www/dolibarr/logs/error.log
	CustomLog /home/www/dolibarr/logs/access.log combined
	
	ErrorDocument 401 /public/error-401.html

        php_flag register_globals on		
	
	&lt;/VirtualHost&gt;	
      </code>
</p>
  </sect1>


  <sect1>
<heading>Fichier de config pour Apache 1.3 + mod_auth_mysql</heading>

    <p>
      Cet exemple ne fonctionne pas sur la sÈrie Apache 2, voir le fichier correspond dans la section suivante.
</p>
<p>
      <code>
	#
	# Sample httpd.conf for dolibarr
	#
	&lt;VirtualHost dolibarr.lafrere.lan&gt;
	ServerAdmin webmaster.fr@lolix.org
	DocumentRoot /home/www/dolibarr/dolibarr/htdocs
	ServerName dolibarr.lafrere.lan
	ErrorLog  /home/www/dolibarr/logs/error.log
	CustomLog /home/www/dolibarr/logs/access.log combined
	
	ErrorDocument 401 /public/error-401.html

        php_flag register_globals on
		
	&lt;Location /&gt;
	Options Indexes FollowSymLinks
	AllowOverride All
	Order deny,allow
	Deny from all

	AuthType 				Basic
	
	# N'utilisez la ligne suivante que si vous utilisez aussi
	# le module d'authentification basÈ sur postgresql
	#Auth_MySQL_Authoritative		on
	
	# Utilisez les lignes suivantes si le serveur Apache ne 
	# peut se logger en anonymous (ce qui est conseillÈ ;-)
	# rq. erics: sur ma debian je n'ai pas le droit de mettre ces
	# instructions dans un &lt;virtualhost&gt; ... (apache 1.3.27.0-2)
	#AuthMySQL_DefaultHost &lt;host&gt;
	#AuthMySQL_DefaultUser &lt;user&gt;
	#AuthMySQL_DefaultPassword &lt;pass&gt;
	
	Auth_MySQL_DB 			dolibarr
	Auth_MySQL_Password_Table 		llx_user
	Auth_MySQL_Username_Field 		login
	Auth_MySQL_Password_Field 		pass
	
	# Pour l'instant les pass sont enregistrÈs en clair
	# le stockage cryptÈ est dans la TODO
	
	Auth_MySQL_Encrypted_Passwords 	off
	
	AuthName        			"Dolibarr"
	
	require valid-user
	satisfy any
	&lt;/Location&gt;
	
	&lt;Location /public/&gt;
	Options Indexes FollowSymLinks
	AllowOverride All
	Order deny,allow
	Allow from all
	&lt;/Location&gt;
	
	&lt;/VirtualHost&gt;	
      </code>
</p>
  </sect1>

  <sect1>
<heading>Fichier de config pour Apache 2 + mod_auth_mysql + webmin</heading>
    <p>


    <code>
      Options Indexes FollowSymLinks
      AllowOverride All
      Order deny,allow
      Deny from all
      
      AuthType Basic
      
      # N'utilisez la ligne suivante que si vous utilisez aussi
      # le module d'authentification basÈ sur postgresql
      AuthMySQLAuthoritative on

      # Utilisez les lignes suivantes si le serveur Apache ne 
      # peut se logger en anonymous (ce qui est conseillÈ ;-)
      # rq. erics: sur ma debian je n'ai pas le droit de mettre ces
      # instructions dans un &lt;virtualhost&gt; ... (apache 1.3.27.0-2)
      #AuthMySQL_DefaultHost &lt;host&gt;
      #AuthMySQL_DefaultUser &lt;user&gt;
      #AuthMySQL_DefaultPassword &lt;pass&gt;

      AuthMySQLHost localhost
      AuthMySQLUser leDBuser
      AuthMySQLPassword leDBpass
      AuthMySQLDB dolibarr
      AuthMySQLUserTable llx_user
      AuthMySQLNameField login
      AuthMySQLPasswordField pass
      
      # Pour l'instant les pass sont enregistrÈs en clair
      # le stockage cryptÈ est dans la TODO
      AuthMySQLCryptedPasswords off
      
      AuthName "Dolibarr"
      
      require valid-user
      Satisfy any
    </code>
    </p>  

    <p>
      Pour les gens qui installent Dolibarr dans un rÈpertoire,
      utilisez Webmin et ajoutez une "Per-Directory Options" ‡ votre
      serveur virtuel. Utilisez "Location" comme "Type" et "/dolibarr"
      comme "Path". Une fois crÈÈe, editez les directives et copiez la
      config ci-dessus, sauvez, restartez Apache et testez en allant ‡
      domainname.com/dolibarr. Le navigateur va vous demander de taper
      le login/pass.
      
      Il faut crÈer des options pour chaque &lt;Location&gt; du fichier httpd.conf donnÈ en exemple.
    </p>
    
    <p>
      Merci ‡ la personne qui m'a transmis ces infos, et aux prÈcÈdentes qui avaient fait de mÍme au sujet d'Apache 2
    </p>

  </sect1>
  
</sect>

</article>
